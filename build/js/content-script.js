function getParent(e){return e.parentElement||e.parentNode}function removeElementMethod(e){try{this.getParent(e).removeChild(e)}catch(e){}}let rules=null,isRmFrame=!0;function updateStorage(){chrome.storage.sync.get({black:{},isRmFrame:!0},function(e){rules=e.black,isRmFrame=e.isRmFrame})}function saveRMFrame(e,t){chrome.storage.sync.get({black:{},isRmFrame:{}},function(n){n.isRmFrame[location.origin]=e,chrome.storage.sync.set(n,function(){e&&RMFrame(),t&&t()})})}function trace(e,t,n){if(t>2||n.length>20)return n;switch(!0){case!!e.className:return~e.id.indexOf("/")?trace(getParent(e),t++,n):trace(getParent(e),t++," ."+e.className+n);case!!e.id:return~e.id.indexOf("/")?trace(getParent(e),0,n):"#"+e.id+n;default:return trace(getParent(e),t++,n)}}function saveMsg(e){const t=location.host;chrome.storage.sync.get({black:{},isRmFrame:!0},function(n){n.black[t]||(n.black[t]=[]);let r=n.black[t];if(~r.indexOf(e))return alert("添加规则重复"),!1;r.push(e),chrome.storage.sync.set(n,function(){alert("添加规则成功"),rmElementByQuery(e)})})}function deleteElement(){let e=rules&&rules[location.origin];e&&e.forEach(function(e){rmElementByQuery(e)})}function querySelect(e){try{return document.querySelectorAll(e)}catch(e){return[]}}function rmElementByQuery(e){querySelect(e).forEach(function(e){removeElementMethod(e)})}function RMFrame(){querySelect("iframe").forEach(function(e){const t=getParent(e),n=t.children;if(n&&1===n.length)removeElementMethod(e);else if("BODY"===t.nodeName||"HTML"===t.nodeName)removeElementMethod(e);else{let e=n.length;for(;e--;){const t=n[e];t&&removeElementMethod(t)}}})}updateStorage(),chrome.runtime.onMessage.addListener(function(e,t,n){if("rmImage"===e.method){let t='img[src="'+e.message+'"]';const n=document.querySelector(t);if(n){return saveMsg(trace(n,0,"")),!0}{let e=querySelect("iframe"),n=e.length;try{for(;n--;){const r=e[n].name;if((r?window.frames[r]:window.frames[n]).document.querySelector(t)){return saveMsg(trace(e[n],0," iframe")),!0}}}catch(e){return void alert("iframe 被阻拦,请手动添加规则")}}alert("规则添加失败,请手动添加")}"deleteElement"!==e.method?"rmFrame"===e.method&&saveRMFrame(e.message,n):saveMsg(e.message)});let async=null;document.onreadystatechange=function(){var e;"interactive"===document.readyState&&("https://www.baidu.com"===location.origin?document.addEventListener("DOMNodeInserted",function(e){let t=e.target;/result c-container/.test(t.className)&&/广告/.test(t.innerText)&&removeElementMethod(t),null!==async&&clearTimeout(async),async=setTimeout(function(){document.querySelectorAll('div[style="display:block !important;visibility:visible !important"]').forEach(function(e){removeElementMethod(e)}),async=null},100)},!1):document.addEventListener("DOMNodeInserted",function(e){null!==async&&clearTimeout(async),async=setTimeout(function(){deleteElement(),isRmFrame&&RMFrame(),async=null},100)},!1),deleteElement(),"https://blog.csdn.net"===location.origin&&(null===(e=document.querySelector("a.btn-readmore"))||void 0===e||e.click()))};