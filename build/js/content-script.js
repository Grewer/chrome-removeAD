"use strict";function getParent(e){return e.parentElement||e.parentNode}function removeElementMethod(e){try{getParent(e).removeChild(e)}catch(e){}}var rules=null,isRmFrame=!0;function updateStorage(){chrome.storage.sync.get({black:{},isRmFrame:!0},function(e){rules=e.black,isRmFrame=e.isRmFrame})}function saveRMFrame(e,t){chrome.storage.sync.get({black:{},isRmFrame:!0},function(r){r.isRmFrame=e,chrome.storage.sync.set(r,function(){e&&RMFrame(),t&&t()})})}function trace(e,t,r){if(t>2||r.length>20)return r;switch(!0){case!!e.className:return~e.id.indexOf("/")?trace(getParent(e),t++,r):trace(getParent(e),t++," ."+e.className+r);case!!e.id:return~e.id.indexOf("/")?trace(getParent(e),0,r):"#"+e.id+r;default:return trace(getParent(e),t++,r)}}function saveMsg(e){var t=location.origin;chrome.storage.sync.get({black:{},isRmFrame:!0},function(r){r.black[t]||(r.black[t]=[]);var n=r.black[t];if(~n.indexOf(e))return alert("添加规则重复"),!1;n.push(e),chrome.storage.sync.set(r,function(){alert("添加规则成功"),rmElementByQuery(e)})})}function deleteElement(){var e=rules&&rules[location.origin];e&&e.forEach(function(e){rmElementByQuery(e)})}function querySelect(e){try{return document.querySelectorAll(e)}catch(e){return[]}}function rmElementByQuery(e){querySelect(e).forEach(function(e){removeElementMethod(e)})}function RMFrame(){querySelect("iframe").forEach(function(e){var t=getParent(e),r=t.children;if(r&&1===r.length)removeElementMethod(e);else if("BODY"===t.nodeName||"HTML"===t.nodeName)removeElementMethod(e);else for(var n=source.length;n--;){var a=source[n];a&&removeElementMethod(a)}})}updateStorage(),chrome.runtime.onMessage.addListener(function(e,t,r){if("rmImage"===e.method){var n='img[src="'+e.message+'"]',a=document.querySelector(n);if(a)return saveMsg(trace(a,0,"")),!0;var c=querySelect("iframe"),o=c.length;try{for(;o--;){var i=c[o].name;if((i?window.frames[i]:window.frames[o]).document.querySelector(n))return saveMsg(trace(c[o],0," iframe")),!0}}catch(e){return void alert("iframe 被阻拦,请手动添加规则")}alert("规则添加失败,请手动添加")}"deleteElement"!==e.method?"rmFrame"===e.method&&saveRMFrame(e.message,r):saveMsg(e.message)});var async=null;document.onreadystatechange=function(){var e;"interactive"===document.readyState&&("https://www.baidu.com"===location.origin?document.addEventListener("DOMNodeInserted",function(e){var t=e.target;/result c-container/.test(t.className)&&/广告/.test(t.innerText)&&removeElementMethod(t),null!==async&&clearTimeout(async),async=setTimeout(function(){document.querySelectorAll('div[style="display:block !important;visibility:visible !important"]').forEach(function(e){removeElementMethod(e)}),async=null},100)},!1):document.addEventListener("DOMNodeInserted",function(e){null!==async&&clearTimeout(async),async=setTimeout(function(){deleteElement(),isRmFrame&&RMFrame(),async=null},100)},!1),deleteElement(),"https://blog.csdn.net"===location.origin&&(null===(e=document.querySelector("a.btn-readmore"))||void 0===e||e.click()))};