"use strict";function removeElementMethod(e){e.parentNode.removeChild(e)}var rules=null;function updateStorage(){chrome.storage.sync.get({black:""},function(e){rules=e.black})}function getParent(e){return e.parentElement||e.parentNode}function trace(e,t,n){if(t>2||n.length>20)return n;switch(!0){case!!e.className:return~e.id.indexOf("/")?trace(getParent(e),t++,n):trace(getParent(e),t++," ."+e.className+n);case!!e.id:return~e.id.indexOf("/")?trace(getParent(e),0,n):"#"+e.id+n;default:return trace(getParent(e),t++,n)}}function saveMsg(e){var t=location.origin;chrome.storage.sync.get({black:{}},function(n){n.black[t]||(n.black[t]=[]);var r=n.black[t];if(~r.indexOf(e))return alert("添加规则重复"),!1;r.push(e),chrome.storage.sync.set(n,function(){alert("添加规则成功"),rmElementByQuery(e)})})}function deleteElement(){var e=rules&&rules[location.origin];e&&e.forEach(function(e){rmElementByQuery(e)})}function querySelect(e){try{return document.querySelectorAll(e)}catch(e){return[]}}function rmElementByQuery(e){querySelect(e).forEach(function(e){removeElementMethod(e)})}updateStorage(),chrome.runtime.onMessage.addListener(function(e,t,n){if("rmImage"===e.method){var r='img[src="'+e.message+'"]',a=document.querySelector(r);if(a)return saveMsg(trace(a,0,"")),!0;var c=querySelect("iframe"),o=c.length;try{for(;o--;){var i=c[o].name;if((i?window.frames[i]:window.frames[o]).document.querySelector(r))return saveMsg(trace(c[o],0," iframe")),!0}}catch(e){return void alert("iframe 被阻拦,请手动添加规则")}alert("规则添加失败,请手动添加")}"deleteElement"===e.method&&saveMsg(e.message)});var async=null;document.onreadystatechange=function(){"interactive"===document.readyState&&("https://www.baidu.com"===location.origin?document.addEventListener("DOMNodeInserted",function(e){var t=e.target;/result c-container/.test(t.className)&&/广告/.test(t.innerText)&&removeElementMethod(t),null!==async&&clearTimeout(async),async=setTimeout(function(){document.querySelectorAll('div[style="display:block !important;visibility:visible !important"]').forEach(function(e){removeElementMethod(e)}),async=null},100)},!1):document.addEventListener("DOMNodeInserted",function(e){null!==async&&clearTimeout(async),async=setTimeout(function(){deleteElement(),async=null},100)},!1),deleteElement(),"https://blog.csdn.net"===location.origin&&document.querySelector("a.btn-readmore").click())};